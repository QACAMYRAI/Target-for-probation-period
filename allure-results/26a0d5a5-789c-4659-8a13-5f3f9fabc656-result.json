{"name": "Тест загрузки изображения питомца", "status": "failed", "statusDetails": {"message": "AssertionError: Статус код 200 не равен 415\nТекст ответа: {\"code\":200,\"type\":\"unknown\",\"message\":\"additionalMetadata: null\\nFile uploaded to ./test.txt, 0 bytes\"}", "trace": "self = <pet_block_test.TestApiPet object at 0x0000024B35446210>\nfile_name = 'test.txt', status_code = 415\n\n    @allure.tag(\"ТК-34\")\n    @allure.severity(severity_level='normal')\n    @allure.title('Тест загрузки изображения питомца')\n    @pytest.mark.parametrize('file_name, status_code',\n                             [\n                                 pytest.param(\"test.txt\", 415, marks=[allure.tag(\"ТК-35\")]),\n                                 pytest.param('images.jpeg', 200, marks=[allure.tag(\"ТК-36\")]),\n                                 pytest.param('images.png', 200, marks=[allure.tag(\"ТК-37\")]),\n                             ]\n    )\n    def test_upload_pet_image(self, file_name, status_code):\n        pet = self.api_methods.add_pet_by_api()\n        pet_id = pet.json()['id']\n        self.created_pet_ids.append(pet_id)\n>       self.api_methods.upload_pet_image_by_api(pet_id, file_name, status_code=status_code).json()\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nfile_name  = 'test.txt'\npet        = <Response [200]>\npet_id     = 94974\nself       = <pet_block_test.TestApiPet object at 0x0000024B35446210>\nstatus_code = 415\n\ntests\\api_tests\\pet_block_test.py:194: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <api.api_methods.API object at 0x0000024B35589E00>, pet_id = 94974\nfile_path = 'test.txt', additional_metadata = None, status_code = 415\n\n    @allure.step('Загрузить фотографию питомца по API')\n    def upload_pet_image_by_api(self, pet_id: int, file_path: str = None,\n                                additional_metadata: str = None, status_code: int = 200):\n    \n        if file_path is None:\n            file_name = 'images.jpeg'\n        else:\n            file_name = str(file_path)\n    \n        control_docs_dir = Path(tests.__file__).parent.parent.joinpath('control_docs')\n        file_path_full = control_docs_dir / file_name\n    \n        if not file_path_full.exists():\n            raise FileNotFoundError(f\"Файл не найден: {file_path_full}\")\n    \n        with open(file_path_full, 'rb') as file:\n            files = {'file': (file_name, file, 'image/jpeg')}\n    \n            data = {}\n            if additional_metadata is not None:\n                data['additionalMetadata'] = str(additional_metadata)\n    \n            response = main_url().post(\n                f'pet/{pet_id}/uploadImage',\n                files=files,\n                data=data\n            )\n    \n>       assert response.status_code == status_code, (\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n            f'Статус код {response.status_code} не равен {status_code}\\n'\n            f'Текст ответа: {response.text}'\n        )\nE       AssertionError: Статус код 200 не равен 415\nE       Текст ответа: {\"code\":200,\"type\":\"unknown\",\"message\":\"additionalMetadata: null\\nFile uploaded to ./test.txt, 0 bytes\"}\n\nadditional_metadata = None\ncontrol_docs_dir = WindowsPath('D:/ispitatil/control_docs')\ndata       = {}\nfile       = <_io.BufferedReader name='D:\\\\ispitatil\\\\control_docs\\\\test.txt'>\nfile_name  = 'test.txt'\nfile_path  = 'test.txt'\nfile_path_full = WindowsPath('D:/ispitatil/control_docs/test.txt')\nfiles      = {'file': ('test.txt', <_io.BufferedReader name='D:\\\\ispitatil\\\\control_docs\\\\test.txt'>, 'image/jpeg')}\npet_id     = 94974\nresponse   = <Response [200]>\nself       = <api.api_methods.API object at 0x0000024B35589E00>\nstatus_code = 415\n\napi\\api_methods.py:146: AssertionError"}, "steps": [{"name": "Добавление питомца по APi", "status": "passed", "steps": [{"name": "POST pet", "status": "passed", "start": 1768224465455, "stop": 1768224466248}], "attachments": [{"name": "Request POST status code - 200", "source": "be454cf6-344a-4e30-9b5e-41272d25c978-attachment.txt", "type": "text/plain"}, {"name": "Response POST", "source": "bbdf70ed-b81d-4825-b069-8e7091332cf7-attachment.json", "type": "application/json"}], "parameters": [{"name": "pet_id", "value": "None"}, {"name": "name", "value": "None"}, {"name": "status", "value": "None"}, {"name": "category", "value": "None"}, {"name": "photo_urls", "value": "None"}, {"name": "tags", "value": "None"}, {"name": "remove_keys", "value": "None"}, {"name": "status_code", "value": "200"}], "start": 1768224465454, "stop": 1768224466250}, {"name": "Загрузить фотографию питомца по API", "status": "failed", "statusDetails": {"message": "AssertionError: Статус код 200 не равен 415\nТекст ответа: {\"code\":200,\"type\":\"unknown\",\"message\":\"additionalMetadata: null\\nFile uploaded to ./test.txt, 0 bytes\"}\n", "trace": "  File \"D:\\ispitatil\\.venv\\Lib\\site-packages\\allure_commons\\_allure.py\", line 202, in impl\n    return func(*a, **kw)\n  File \"D:\\ispitatil\\api\\api_methods.py\", line 146, in upload_pet_image_by_api\n    assert response.status_code == status_code, (\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n"}, "steps": [{"name": "POST pet/94974/uploadImage", "status": "passed", "start": 1768224466251, "stop": 1768224466935}], "attachments": [{"name": "Request POST status code - 200", "source": "9e0be80f-da13-4484-809b-8e9ae3debbe0-attachment.txt", "type": "text/plain"}, {"name": "Response POST", "source": "409289f4-6c9b-4874-a087-7ebeb91b87f8-attachment.json", "type": "application/json"}], "parameters": [{"name": "pet_id", "value": "94974"}, {"name": "file_path", "value": "'test.txt'"}, {"name": "additional_metadata", "value": "None"}, {"name": "status_code", "value": "415"}], "start": 1768224466251, "stop": 1768224466936}], "attachments": [{"name": "Validated PetResponse", "source": "81d3c9b3-6230-4382-b3f3-c4f7c2196eee-attachment.json", "type": "application/json"}], "parameters": [{"name": "file_name", "value": "'test.txt'"}, {"name": "status_code", "value": "415"}], "start": 1768224465454, "stop": 1768224466937, "uuid": "14e705da-b3c0-41b7-8a88-454f11bea053", "historyId": "364dfd93f14de90d2e780198067fab48", "testCaseId": "645e29053ea27ac568445597a546cc5e", "fullName": "tests.api_tests.pet_block_test.TestApiPet#test_upload_pet_image", "labels": [{"name": "tag", "value": "ТК-35"}, {"name": "suite", "value": "Блок Pet"}, {"name": "story", "value": "API тесты"}, {"name": "tag", "value": "ТК-34"}, {"name": "severity", "value": "normal"}, {"name": "parentSuite", "value": "tests.api_tests"}, {"name": "subSuite", "value": "TestApiPet"}, {"name": "host", "value": "DESKTOP-6MNN1FG"}, {"name": "thread", "value": "28328-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "tests.api_tests.pet_block_test"}], "titlePath": ["tests", "api_tests", "pet_block_test.py", "TestApiPet"]}